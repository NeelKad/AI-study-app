<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flashcards - AI Study App</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}" />
  <style>
    :root {
      --bg-primary: #0f0f23;
      --bg-secondary: #1a1a3a;
      --bg-tertiary: #252547;
      --bg-border: #3a3a5c;
      --text-primary: #e2e8f0;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --accent: #6366f1;
      --success: #10b981;
      --error: #ef4444;
      --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    }

    body {
      background: var(--bg-primary);
      color: var(--text-primary);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      margin: 0;
      min-height: 100vh;
    }

    /* Navigation */
    .navbar {
      background: var(--bg-secondary);
      padding: 1rem 2rem;
      border-bottom: 1px solid var(--bg-border);
    }

    .nav-logo {
      font-size: 1.25rem;
      font-weight: 700;
      color: var(--accent);
      text-decoration: none;
    }

    .nav-logo:hover {
      color: var(--text-primary);
    }

    /* Buttons */
    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
      font-size: 0.875rem;
      font-weight: 600;
      text-decoration: none;
      border-radius: 0.5rem;
      border: 1px solid transparent;
      cursor: pointer;
      transition: all 0.2s ease;
      background: var(--accent);
      color: white;
      user-select: none;
    }

    .button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    .button-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-color: var(--bg-border);
    }

    .button-secondary:hover:not(:disabled) {
      background: var(--bg-border);
    }

    /* Flashcard */
    #flashcard {
      cursor: pointer;
      padding: 3rem 2rem;
      min-height: 250px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 1.25rem;
      line-height: 1.5;
      transition: all 0.2s ease;
      user-select: none;
      border: 2px solid transparent;
      background: var(--bg-secondary);
      border-radius: 0.75rem;
      box-shadow: var(--shadow-sm);
      margin-bottom: 2rem;
    }

    #flashcard:hover {
      border-color: var(--accent);
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    #flashcard.flipped {
      background: var(--bg-tertiary);
      border-color: var(--success);
    }

    /* Disabled buttons */
    .button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      background: var(--bg-tertiary);
      color: var(--text-muted);
      border-color: var(--bg-border);
    }

    /* Card Counter */
    #cardCounter {
      text-align: center;
      color: var(--accent);
      font-weight: 600;
      font-size: 0.875rem;
      margin-bottom: 1rem;
      user-select: none;
    }

    /* Loading indicator */
    #loadingIndicator {
      display: none;
      text-align: center;
      margin: 2rem 0;
    }

    .spinner {
      width: 20px;
      height: 20px;
      border: 2px solid var(--bg-border);
      border-top: 2px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: inline-block;
      vertical-align: middle;
      margin-right: 0.75rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Controls container */
    #controls {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    /* Review buttons */
    .review-btn {
      padding: 0.6rem 1.2rem;
      border-radius: 0.5rem;
      border: none;
      font-weight: 600;
      cursor: pointer;
      color: white;
      user-select: none;
      transition: background 0.3s ease;
    }

    .review-again {
      background-color: #ef4444; /* red */
    }
    .review-hard {
      background-color: #f97316; /* orange */
    }
    .review-good {
      background-color: #10b981; /* green */
    }
    .review-easy {
      background-color: #3b82f6; /* blue */
    }

    .review-btn:hover {
      filter: brightness(0.9);
    }

    /* Responsive */
    @media (max-width: 768px) {
      #flashcard {
        padding: 2rem 1.5rem;
        min-height: 200px;
        font-size: 1.125rem;
      }

      .button, .review-btn {
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation Header -->
  <header>
    <nav class="navbar">
      <div style="display: flex; align-items: center; justify-content: space-between; width: 100%; max-width: 1200px; margin: 0 auto;">
        <a href="{{ url_for('index') }}" class="nav-logo">AI Study App</a>
        <div style="display: flex; gap: 1rem; align-items: center;">
          <a href="{{ url_for('dashboard') }}" class="button button-secondary" style="padding: 0.5rem 1rem; font-size: 0.8125rem;">
            ‚Üê Dashboard
          </a>
        </div>
      </div>
    </nav>
  </header>

  <main style="padding: 2rem; max-width: 900px; margin: 0 auto;">
    <h1 style="text-align: center; margin-bottom: 1rem; color: var(--accent);">Flashcards Review</h1>

    <div id="loadingIndicator">
      <div style="display: inline-flex; align-items: center; gap: 0.75rem; padding: 1rem 1.5rem; background: var(--bg-secondary); border-radius: 0.75rem; border: 1px solid var(--bg-border);">
        <div class="spinner"></div>
        <span style="color: var(--text-secondary); font-weight: 500;">Loading due flashcards...</span>
      </div>
    </div>

    <div id="flashcard">Loading...</div>

    <div id="controls" style="display:none;">
      <button class="review-btn review-again" data-quality="0">Again</button>
      <button class="review-btn review-hard" data-quality="1">Hard</button>
      <button class="review-btn review-good" data-quality="2">Good</button>
      <button class="review-btn review-easy" data-quality="3">Easy</button>
    </div>

    <div id="cardCounter"></div>
  </main>

  <script>
    const flashcardDiv = document.getElementById("flashcard");
    const loadingIndicator = document.getElementById("loadingIndicator");
    const controls = document.getElementById("controls");
    const cardCounter = document.getElementById("cardCounter");

    let flashcards = [];
    let currentIndex = 0;
    let showingDefinition = false;

    function showLoading() {
      loadingIndicator.style.display = "block";
      flashcardDiv.style.display = "none";
      controls.style.display = "none";
      cardCounter.textContent = "";
    }

    function hideLoading() {
      loadingIndicator.style.display = "none";
      flashcardDiv.style.display = "flex";
      controls.style.display = "flex";
    }

    function updateCardCounter() {
      if (flashcards.length > 0) {
        cardCounter.textContent = `Card ${currentIndex + 1} of ${flashcards.length}`;
      } else {
        cardCounter.textContent = "No flashcards due for review.";
      }
    }

    function updateFlashcard() {
      if (flashcards.length === 0) {
        flashcardDiv.textContent = "No flashcards due for review.";
        controls.style.display = "none";
        cardCounter.textContent = "";
        return;
      }

      const card = flashcards[currentIndex];
      if (showingDefinition) {
        flashcardDiv.textContent = typeof card.definition === "string" ? card.definition : JSON.stringify(card.definition, null, 2);
        flashcardDiv.classList.add("flipped");
      } else {
        flashcardDiv.textContent = typeof card.term === "string" ? card.term : JSON.stringify(card.term);
        flashcardDiv.classList.remove("flipped");
      }

      updateCardCounter();
    }

    flashcardDiv.addEventListener("click", () => {
      if (flashcards.length > 0) {
        showingDefinition = !showingDefinition;
        updateFlashcard();
      }
    });

    controls.addEventListener("click", async (e) => {
      if (!e.target.classList.contains("review-btn")) return;

      const quality = parseInt(e.target.dataset.quality, 10);
      const card = flashcards[currentIndex];

      try {
        const res = await fetch(`/api/flashcards/review/${card.id}`, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({quality}),
        });

        if (!res.ok) throw new Error("Failed to update flashcard");

        // Remove reviewed card from array
        flashcards.splice(currentIndex, 1);

        // Adjust current index
        if (currentIndex >= flashcards.length && currentIndex > 0) {
          currentIndex--;
        }

        showingDefinition = false;
        updateFlashcard();
      } catch (err) {
        alert(err.message);
      }
    });

    async function loadDueFlashcards() {
      showLoading();

      try {
        const res = await fetch('/api/flashcards/due');
        if (!res.ok) throw new Error("Failed to load flashcards");
        flashcards = await res.json();
        hideLoading();
        currentIndex = 0;
        showingDefinition = false;
        updateFlashcard();
      } catch (err) {
        flashcardDiv.textContent = `Error loading flashcards: ${err.message}`;
        controls.style.display = "none";
        cardCounter.textContent = "";
      }
    }

    window.onload = loadDueFlashcards;
  </script>
</body>
</html>
